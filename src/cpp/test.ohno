:trace on
:names on

:def env [1 #0 0]
:def stk [1 #0 0]
:def hd [sel #0 1]
:def tl [sel #1 0]
:def kont [sel #0 1]
:def heap [sel #1 1]
:def pop0 [sel #2 0]
:def pop1 [sel #3 0]
:def pop2 [sel #4 0]
:def pop3 [sel #5 0]
:def v0 [sel #2 1]
:def v1 [sel #3 1]
:def v2 [sel #4 1]

:def exitenv [env exit']
:def exitval [[sel #1 1] exit']
:def mk21 [pop0 #21' heap kont]
:def id [pop1 v0 heap kont]

:def memory [0 0 0 0 0 0]
:def f id

% call a function
% ![f [exitenv memory #21 nil]]

% stage a function call
% ![[stk #22' heap' id' exitenv' %] nil]


:def inc_table [#1 #2 #3 #4 #5 #6 #7 #8 #9 #10 nil]
:def add_table [
	[#0 #1 #2 #3 #4 #5 nil]
	[#1 #2 #3 #4 #5 #6 nil]
	[#2 #3 #4 #5 #6 #7 nil]
	[#3 #4 #5 #6 #7 #8 nil]
	[#4 #5 #6 #7 #8 #9 nil]
	[#5 #6 #7 #8 #9 #10 nil]
nil]

:def lookup1 [1' v1 1' #2' sel' env [kont' heap' tl pop2' hd [hd tl]']']
:def lookup2 [1' v2 1' v1 1' #2' sel' env [kont' heap' tl pop3' hd [hd tl]']']

% stage a function call
% ![lookup1 [exitenv memory inc_table #3 nil]]
% ![lookup2 [exitenv memory add_table #4 #3 nil]]

% define a function
:def inc [pop1 v0 inc_table' heap' lookup1' kont %]
:def add [pop2 v0 v1 add_table' heap' lookup2' kont %]
% ![inc [exitval memory #3 nil]]
![add [exitval memory #3 #4 nil]]


